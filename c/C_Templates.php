<?php//// Конттроллер страниц.//class C_Templates extends C_Admin_Base{	//	// Конструктор.	//	public function __construct(){		parent::__construct();	}		public function before(){		parent::before();				if(!M_Users::Instance()->Can('ALL'))			$this->p404();	}	public function action_index(){		$this->action_base();	}		public function action_base()	{		$this->title .= '::Шаблоны страниц';			$tpl_num = isset($this->params[2]) ? (int)$this->params[2] : 1;        $mPagination = new Pagination('templates', '/templates/base/');        $templates = $mPagination->where("ttype='0'")->on_page(10)->page_num($tpl_num)->page();                $navbar = $this->Template('v_navbar.php', array('navparams' => $mPagination->navparams()));        $this->content = $this->Template('templates/v_all.php', array('templates' => $templates,                                                                       'navparams' => $mPagination->navparams(),                                                                       'navbar' => $navbar));	}		public function action_inner()	{		$this->title .= '::Шаблоны страниц';			$tpl_num = isset($this->params[2]) ? (int)$this->params[2] : 1;        $mPagination = new Pagination('templates', '/templates/inner/');        $templates = $mPagination->where("ttype='1'")->on_page(5)->page_num($tpl_num)->page();                $navbar = $this->Template('v_navbar.php', array('navparams' => $mPagination->navparams()));        $this->content = $this->Template('templates/v_all.php', array('templates' => $templates,                                                                       'navparams' => $mPagination->navparams(),                                                                       'navbar' => $navbar));	}		public function action_add_base()	{		$this->title .= ' :: Добавление базового шаблона';		$messages = array(); 		$mTpl = M_Templates::Instance();		if($this->isPost())		{			if($mTpl->add($_POST))				$this->redirect("/templates/base");						$fields = $_POST;			$messages = $mTpl->errors();		}				$this->content = $this->Template('templates/v_add.php', array('fields' => $fields,						'messages' => $messages, 'templates' => $mTpl->get_templates(0), 'type' => '0'));			}		public function action_add_inner()	{		$this->title .= ' :: Добавление внутреннего шаблона';		$messages = array(); 		$mTpl = M_Templates::Instance();		if($this->isPost())		{			if($mTpl->add($_POST))				$this->redirect("/templates/inner");						$fields = $_POST;			$messages = $mTpl->errors();		}				$this->content = $this->Template('templates/v_add.php', array('fields' => $fields,						'messages' => $messages, 'templates' => $mTpl->get_templates(1), 'type' => '1'));			}	public function action_delete()	{		if($this->IsGet() && M_Users::Instance()->Can('ALL'))            M_Templates::Instance()->delete($this->params[2]);			        $this->redirect('/templates');    }}